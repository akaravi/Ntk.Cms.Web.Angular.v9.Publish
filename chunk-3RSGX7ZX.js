import{Je as p,ca as h,fa as o,g as a,hd as f,nd as m,od as l,pd as S}from"./chunk-XKQYEJGP.js";var k=(()=>{let r=class r{constructor(i,t,s){this.coreAuthService=i,this.cmsApiStore=t,this.router=s,this.runSubscribe=!1}canActivate(i,t){return a(this,null,function*(){let s=this.coreAuthService.getUserToken();if(!s||s.length===0)return this.router.navigate(["auth"],{queryParams:{returnUrl:t.url}}),!1;let c=this.cmsApiStore.getStateSnapshot(),e=new m;if(c?.ntkCmsAPiState?.tokenInfo&&(e=c.ntkCmsAPiState.tokenInfo,e&&e.userId>0&&e.siteId>0))return!0;for(this.subscriptions=this.coreAuthService.ServiceCurrentToken().subscribe({next:u=>{this.cmsApiStore.setState({type:S,payload:u.item}),e=u.item,this.runSubscribe=!0},error:u=>{this.runSubscribe=!0}});!this.runSubscribe;)yield this.delay(1e3);return(!e||!e.userId||e.userId<=0)&&this.router.navigate(["auth"],{queryParams:{returnUrl:t.url}}),e&&e.siteId>0?!0:(this.router.navigate(["/core/site/selection"],{queryParams:{returnUrl:t.url}}),!1)})}delay(i){return new Promise(t=>setTimeout(t,i))}ngOnDestroy(){this.subscriptions.unsubscribe()}};r.\u0275fac=function(t){return new(t||r)(o(p),o(l),o(f))},r.\u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"});let n=r;return n})();export{k as a};
