import{c as l,l as b}from"./chunk-RXGSDVLF.js";import{Fe as m,Ge as S,ca as h,fa as s,g as a,hd as f}from"./chunk-FSW4BEJP.js";var g=(()=>{let t=class t{constructor(i,r,o){this.cmsStoreService=i,this.coreAuthService=r,this.router=o,this.runSubscribe=!1}canActivate(i,r){return a(this,null,function*(){let o=this.coreAuthService.getUserToken();if(!o||o.length===0)return this.router.navigate(["auth"],{queryParams:{returnUrl:r.url}}),!1;let c=this.cmsStoreService.getStateSnapshot(),e=new m;if(c?.tokenInfoStore&&(e=c.tokenInfoStore,e&&e.userId>0&&e.siteId>0))return!0;for(this.subscriptions=this.coreAuthService.ServiceCurrentToken().subscribe({next:u=>{this.cmsStoreService.setState({type:l,payload:u.item}),e=u.item,this.runSubscribe=!0},error:u=>{this.runSubscribe=!0}});!this.runSubscribe;)yield this.delay(1e3);return(!e||!e.userId||e.userId<=0)&&this.router.navigate(["auth"],{queryParams:{returnUrl:r.url}}),e&&e.siteId>0?!0:(this.router.navigate(["/core/site/selection"],{queryParams:{returnUrl:r.url}}),!1)})}delay(i){return new Promise(r=>setTimeout(r,i))}ngOnDestroy(){this.subscriptions.unsubscribe()}};t.\u0275fac=function(r){return new(r||t)(s(b),s(S),s(f))},t.\u0275prov=h({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();export{g as a};
