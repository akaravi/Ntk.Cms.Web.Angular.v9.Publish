import{n as h,p as m}from"./chunk-DZ6Q7KCE.js";import{Fe as l,Ge as f,ca as a,fa as o,g as u,hd as c}from"./chunk-LELKRAIN.js";var S=(()=>{let t=class t{constructor(i,r,n,e){this.tokenHelper=i,this.cmsStoreService=r,this.coreAuthService=n,this.router=e,this.runSubscribe=!1}canActivate(i,r){return u(this,null,function*(){let n=this.tokenHelper.coreAuthService.getUserToken();if(!n||n.length===0)return this.router.navigate(["auth"],{queryParams:{returnUrl:r.url}}),!1;let e=new l;if(yield this.tokenHelper.getTokenInfoState().then(p=>{e=p}),e&&e.userId>0&&e.siteId>0)return!0;for(;!this.runSubscribe;)yield this.delay(1e3);if(!e||!e.userId||e.userId<=0)this.router.navigate(["auth"],{queryParams:{returnUrl:r.url}});else if(e&&e.siteId>0)return!0;return this.router.navigate(["/core/site/selection"],{queryParams:{returnUrl:r.url}}),!1})}delay(i){return new Promise(r=>setTimeout(r,i))}ngOnDestroy(){this.subscriptions.unsubscribe()}};t.\u0275fac=function(r){return new(r||t)(o(m),o(h),o(f),o(c))},t.\u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"});let s=t;return s})();export{S as a};
